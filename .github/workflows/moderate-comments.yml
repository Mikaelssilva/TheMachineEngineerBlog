name: Simple Comment Moderation

on:
  discussion_comment:
    types: [created]

jobs:
  moderate:
    runs-on: ubuntu-latest
    steps:
      - name: Modera√ß√£o autom√°tica com resposta em thread
        uses: actions/github-script@v6
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const badWords = [
              'puta', 'merda', 'fdp', 'caralho', 'porra', 'buceta',
              'macaco', 'negrinho', 'veado', 'bicha', 'retardado',
              'vai se matar', 'corno', 'idiota', 'burro'
            ];

            const comment = context.payload.comment;
            const commentText = comment.body.toLowerCase();
            const author = comment.user.login;
            const discussion = context.payload.discussion;
            const discussionNumber = discussion.number;

            console.log(`üîç Verificando coment√°rio de @${author}...`);
            const foundBadWords = badWords.filter(word =>
              commentText.includes(word.toLowerCase())
            );

            if (foundBadWords.length > 0) {
              console.log(`üö® Linguagem ofensiva detectada: ${foundBadWords.join(', ')}`);

              const issueBody = `## üö® Coment√°rio Inadequado Detectado

**Autor:** @${author}  
**Discuss√£o:** [${discussion.title}](${discussion.html_url})  
**Data:** ${new Date().toLocaleString('pt-BR')}  
**Palavras detectadas:** \`${foundBadWords.join(', ')}\`

**Coment√°rio original:**
> ${comment.body}

üîó [Ver coment√°rio](${comment.html_url})  
üîó [Ver discuss√£o completa](${discussion.html_url})

---

**A√ß√µes sugeridas:**
- [ ] Revisar o coment√°rio
- [ ] Remover se necess√°rio
- [ ] Alertar o usu√°rio
- [ ] Tomar medidas administrativas

*Issue gerada automaticamente pelo sistema de modera√ß√£o.*`;

              // Cria uma issue de modera√ß√£o
              await github.rest.issues.create({
                owner: context.repo.owner,
                repo: context.repo.repo,
                title: `üö® Modera√ß√£o: Coment√°rio de @${author}`,
                body: issueBody,
                labels: ['modera√ß√£o', 'urgente'],
                assignees: ['Mikaelssilva']
              });

              // Adiciona rea√ß√£o üëÄ
              await github.rest.reactions.createForDiscussionComment({
                owner: context.repo.owner,
                repo: context.repo.repo,
                comment_id: comment.id,
                content: 'eyes'
              });

              // Adiciona rea√ß√£o ‚ö†Ô∏è
              await github.rest.reactions.createForDiscussionComment({
                owner: context.repo.owner,
                repo: context.repo.repo,
                comment_id: comment.id,
                content: 'warning'
              });

              // Responde diretamente ao coment√°rio
              const reply = `Ol√° @${author}, este coment√°rio foi marcado automaticamente por conter termos considerados ofensivos.  
Pedimos que mantenha o respeito nas intera√ß√µes. A modera√ß√£o ser√° feita conforme as regras do blog.`;

              await github.rest.issues.createComment({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: discussionNumber,
                body: `> _Coment√°rio de @${author}_\n\n‚ö†Ô∏è ${reply}`
              });

              console.log("‚úÖ Modera√ß√£o conclu√≠da: Issue + resposta enviada.");
            } else {
              console.log('‚úÖ Nenhum termo ofensivo detectado.');
            }
