name: Simple Comment Moderation
on:
  discussion_comment:
    types: [created]

jobs:
  moderate:
    runs-on: ubuntu-latest
    steps:
      - name: Check and report bad comments
        uses: actions/github-script@v6
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            // Lista de palavras proibidas (adicione as suas)
            const badWords = [
              'puta', 'merda', 'fdp', 'caralho', 'porra', 'buceta',
              'macaco', 'negrinho', 'veado', 'bicha', 'retardado',
              'vai se matar', 'corno', 'idiota', 'burro'
            ];
            
            // Obt√©m o coment√°rio
            const comment = context.payload.comment;
            const commentText = comment.body.toLowerCase();
            const author = comment.user.login;
            const discussionTitle = context.payload.discussion.title;
            const discussionNumber = context.payload.discussion.number;
            
            console.log(`üîç Verificando coment√°rio de @${author}`);
            console.log(`üìù Texto: "${comment.body}"`);
            
            // Verifica se cont√©m palavras proibidas
            let foundBadWords = [];
            for (const word of badWords) {
              if (commentText.includes(word.toLowerCase())) {
                foundBadWords.push(word);
              }
            }
            
            if (foundBadWords.length > 0) {
              console.log(`üö® CONTE√öDO INADEQUADO DETECTADO!`);
              console.log(`üìç Palavras encontradas: ${foundBadWords.join(', ')}`);
              
              // Cria uma issue para modera√ß√£o manual
              try {
                const issueBody = `## üö® Coment√°rio Inadequado Detectado
                
**Detalhes:**
- **Autor:** @${author}
- **Discussion:** [${discussionTitle}](${context.payload.discussion.html_url}) (#${discussionNumber})
- **Data:** ${new Date().toLocaleString('pt-BR')}
- **Palavras detectadas:** \`${foundBadWords.join(', ')}\`

**Coment√°rio original:**
> ${comment.body}

**Links √∫teis:**
- [Ver coment√°rio](${comment.html_url})
- [Ver discussion completa](${context.payload.discussion.html_url})

---
**A√ß√µes sugeridas:**
- [ ] Revisar o coment√°rio
- [ ] Deletar se necess√°rio
- [ ] Avisar o usu√°rio sobre as regras
- [ ] Adicionar o usu√°rio √† lista de observa√ß√£o

*Esta issue foi criada automaticamente pelo sistema de modera√ß√£o.*`;

                await github.rest.issues.create({
                  owner: context.repo.owner,
                  repo: context.repo.repo,
                  title: `üö® Modera√ß√£o: Coment√°rio de @${author}`,
                  body: issueBody,
                  labels: ['modera√ß√£o', 'urgente', 'coment√°rio-inadequado'],
                  assignees: ['Mikaelssilva'] // Coloque seu username aqui
                });
                
                console.log('‚úÖ Issue de modera√ß√£o criada com sucesso!');
                
                // Opcional: Adiciona uma rea√ß√£o ao coment√°rio para marcar
                try {
                  await github.rest.reactions.createForDiscussionComment({
                    owner: context.repo.owner,
                    repo: context.repo.repo,
                    comment_id: comment.id,
                    content: 'eyes' // üëÄ rea√ß√£o para indicar que est√° sendo revisado
                  });
                  console.log('üëÄ Rea√ß√£o adicionada ao coment√°rio');
                } catch (reactionError) {
                  console.log('‚ö†Ô∏è N√£o foi poss√≠vel adicionar rea√ß√£o:', reactionError.message);
                }
                
              } catch (error) {
                console.error('‚ùå Erro ao criar issue:', error.message);
                core.setFailed(`Falha ao criar issue de modera√ß√£o: ${error.message}`);
              }
              
            } else {
              console.log('‚úÖ Coment√°rio aprovado - nenhum conte√∫do inadequado encontrado');
            }
            
            // Log final
            console.log(`üìä Verifica√ß√£o conclu√≠da para coment√°rio #${comment.id}`);
